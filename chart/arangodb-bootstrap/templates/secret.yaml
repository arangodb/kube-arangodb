{{- $root := . -}}
apiVersion: v1
kind: Secret
metadata:
  name: {{ template "arangodb-bootstrap.fullName" . }}
  namespace: {{ .Release.Namespace }}
{{- if .Values.job.annotations }}
  annotations:
{{ toYaml .Values.operator.annotations | indent 4 }}
{{- end }}
  labels:
    app.kubernetes.io/name: {{ template "arangodb-bootstrap.name" . }}
    helm.sh/chart: {{ .Chart.Name }}-{{ .Chart.Version }}
    app.kubernetes.io/managed-by: {{ .Release.Service }}
    app.kubernetes.io/instance: {{ .Release.Name }}
    release: {{ .Release.Name }}
{{- if .Values.users }}
data:
{{- range $u, $s := .Values.users }}
{{- $key := include "secret.name" $u -}}
{{- if eq $s "" }}
{{- if $root.Release.IsInstall }}
  {{ $key }}: {{ randAlphaNum 20 | b64enc }}
{{- else }}
  {{ $key }}: {{ index (lookup "v1" "Secret" $root.Release.Namespace (include "arangodb-bootstrap.fullName" $root)).data $key }}
{{- end }}
{{- else }}
  {{ $key }}: {{ $s | b64enc | quote }}
{{- end }}
{{- end }}
{{- else }}
data: {}
{{- end }}
